"use strict";angular.module("dcm-ui.read-file",[]),angular.module("dcm-ui.read-file").directive("dcmDropZone",["$timeout",function(e){return{restrict:"A",scope:{dcmDropZone:"="},link:function(t,n){var a,o=!1;n.on("dragstart dragenter dragover",function(t){_.findWhere(t.originalEvent.dataTransfer.types,"Files")&&(t.stopPropagation(),t.preventDefault(),e.cancel(a),o||(o=!0,n.addClass("drop-zone-hover")),t.originalEvent.dataTransfer.effectAllowed="copyMove",t.originalEvent.dataTransfer.dropEffect="move")}).on("drop dragleave dragend",function(){e.cancel(a),a=e(function(){o=!1,n.removeClass("drop-zone-hover")},70)}),n.on("drop",function(e){e.stopPropagation(),e.preventDefault(),t.dcmDropZone(e.originalEvent)})}}}]),angular.module("dcm-ui.read-file").directive("dcmReadFile",["$window","$q","$log",function(e,t,n){return{require:"?ngModel",restrict:"A",scope:{into:"=?dcmReadFile",format:"@",display:"@",openFileSelect:"=?",dropHandler:"=?"},compile:function(n,a){if(!n.is("input")||!a.type||"file"!==a.type.toLowerCase())throw{message:"attempted to use dcm-read-file on an element which is not a file input: "+n.get(0).tagName};return function(n,a,o,r){if(n.format=n.format||"",!e.FileReader)return a.after('<input class="form-control" disabled value="File reading is not supported in this browser.">'),void a.detach();var i=function(e){var t=e.match(/\.([^.]+)$/);return t?t[1]:""},l=function(e){if("auto"!==n.format)return"text"===n.format?"text":"file"===n.format?"file":"uri";switch(i(e.name)){case"txt":case"text":case"yaml":return"text";default:return"uri"}},u=function(n){var a=t.defer(),u=new e.FileReader,s=function(){u.onloadend=null,u.onerror=null,u.onabort=null,u=null};return u.onerror=s,u.onabort=s,u.onloadend=function(){var e;if("file"===l(n)){var t=u.result.indexOf(",");e=-1===t?"":u.result.substring(t+1)}else e=u.result;if(r&&o.filesize&&n.size>parseInt(o.filesize,10))r.$setValidity("filesize",!1),r.$setDirty(),a.reject();else{var c={data:e,size:n.size,name:n.name,lastModified:n.lastModified,extension:i(n.name),type:l(n)},d=c.name.match(/\.([^.]+)$/);d&&(c.extension=d[1]),a.resolve(c)}s()},"text"===l(n)?u.readAsText(n):u.readAsDataURL(n),a.promise},s=function(e){r&&o.filesize&&r.$setValidity("filesize",!0);for(var a=[],i=0;i<e.length;i++)a.push(u(e[i]));t.all(a).then(function(e){o.dcmReadFile&&(o.multiple?n.into=e:n.into=e[0]),r&&r.$setViewValue(o.multiple?_.pluck(e,"data"):e[0].data)},function(){o.dcmReadFile&&(o.multiple?n.into=[]:n.into=void 0),r&&r.$setViewValue(o.multiple?[]:"")})};a.change(function(e){s(e.target.files)}),n.openFileSelect=function(){a.click()},n.dropHandler=function(e){s(e.dataTransfer.files)}}}}}]);
//# sourceMappingURL=dcm-ui-read-file.min.js.map