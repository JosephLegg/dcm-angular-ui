"use strict";angular.module("dcm-ui.select2",[]),angular.module("dcm-ui.select2").directive("dcmSelect2",["$q","$filter","$parse",function(a,b,c){return{restrict:"A",replace:!1,require:"ngModel",scope:!1,transclude:!1,compile:function(b){if(!b.is("input[type=hidden]"))throw'only <input type="hidden"> tags can have this attribute';return function(b,d,e,f){var g,h,i=e.idField||"id",j=e.textField||"text",k=e.modelSelected?c(e.modelSelected).assign:angular.noop,l=e.selectedOptGroup?c(e.selectedOptGroup).assign:angular.noop,m=e.selectedOptGroup?c(e.selectedOptGroup):angular.noop,n=e.optGroupIdField||"id",o={},p=function(){if(void 0===h){var a=c(e.data)(b);angular.isFunction(a)?(g=a(),h=!0):h=!1}return h?g:c(e.data)(b)},q=function(a){var b=[];return angular.forEach(a,function(a){a.hasOwnProperty(i)&&b.push(a),a.hasOwnProperty("children")&&angular.isArray(a.children)&&a.children.length&&b.push.apply(b,a.children)}),b},r=function(a,c){var d={objectData:null,idData:""},e=q(a);if(o.multiple){c=c?c:[];var f=[],g=[],h={};return angular.forEach(c,function(a){h[a.toString()]=!0}),angular.forEach(e,function(a){h.hasOwnProperty(a[i].toString())&&(f.push(a[i]),g.push(a))}),d.objectData=g,d.idData=f,d}return c=c?c:"",angular.forEach(e,function(a){return a[i].toString()===c.toString()?(l(b,a[n]),d.objectData=a,void(d.idData=c)):void 0}),d},s=function(a){return a?angular.isArray(a)&&0===a.length?!0:!1:!0},t={dropdownAutoWidth:!1,width:"off",query:function(c){a.when(p()).then(function(a){var d=[];if(a||(a=[]),c.term&&""!==c.term){var e=c.term.toLowerCase();angular.forEach(a,function(a){var b=angular.copy(a),c=!1,f=b.children;b.children=[],-1!==b[j].toString().toLowerCase().indexOf(e)&&(c=!0),f&&angular.isArray(f)&&angular.forEach(f,function(a){-1!==a[j].toString().toLowerCase().indexOf(e)&&(c=!0,b.children.push(a))}),c&&d.push(b)})}else d=a.slice(0);var f=m(b);if(f){var g={};g[n]=f;var h=_.findWhere(d,g);if(h){var i=_.indexOf(d,h);d.splice(i,1),d.splice(0,0,h)}}c.callback({more:!1,results:d})})},formatResult:function(a,b,c,d){var e=[];return window.Select2.util.markMatch(a[j],c.term,e,d),e.join("")},formatSelection:function(a,b,c){return c(a[j])},id:function(a){return a[i]},initSelection:function(d,g){var h=b.$eval(e.ngModel);a.when(p()).then(function(a){var d=r(a,h);g(d.objectData),f.$viewValue=d.idData,k(b,d.objectData),s(d.idData)&&c(e.ngModel).assign(b,d.idData)})},formatSearching:function(){return"Loading..."}};angular.extend(o,t,b.$eval(e.dcmSelect2)),d.select2(o),d.on("change",function(a){b.$apply(function(){f.$setViewValue(a.val),c(e.ngModel).assign(b,a.val),k(b,d.select2("data")),e.sticky&&c(e.sticky).assign(b,a.val)})}),e.$observe("disabled",function(a){d.select2("enable",!a)}),e.$observe("readonly",function(a){d.select2("readonly",!!a)}),b.$watch(c(e.ngModel),function(a){if(s(a)){var f=o.multiple?[]:"";angular.equals(a,f)||c(e.ngModel).assign(b,f),d.select2("data",f,!1),k(b,f)}else e.sticky&&c(e.sticky).assign(b,a),d.select2("val",a,!1)}),e.modelSelected&&b.$watch(c(e.modelSelected),function(a){if(!angular.equals(a,d.select2("data"))){d.select2("data",a,!1);var g=d.select2("val");f.$viewValue=g,c(e.ngModel).assign(b,g)}}),b.$watchCollection(p,function(g){var h=d.select2("val");(e.sticky||!s(h))&&a.when(g).then(function(a){var g,i=h;e.sticky&&s(h)&&(i=c(e.sticky)(b)),g=r(a,i),angular.equals(h,g.idData)||(d.select2("data",g.objectData,!1),k(b,g.objectData),f.$viewValue=g.idData,c(e.ngModel).assign(b,g.idData))})})}}}}]);
//# sourceMappingURL=dcm-ui-select2.min.js.map