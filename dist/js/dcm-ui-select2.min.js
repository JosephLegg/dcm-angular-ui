"use strict";angular.module("dcm-ui.select2",[]),angular.module("dcm-ui.select2").directive("dcmSelect2",["$q","$filter","$parse",function(e,n,t){return{restrict:"A",replace:!1,require:"ngModel",scope:!1,transclude:!1,compile:function(n){if(!n.is("input[type=hidden]"))throw'only <input type="hidden"> tags can have this attribute';return function(n,a,o,r){var i,l,u=o.idField||"id",s=o.textField||"text",c=o.iconField||"icon",d=o.modelSelected?t(o.modelSelected).assign:angular.noop,p=o.selectedOptGroup?t(o.selectedOptGroup).assign:angular.noop,g=o.selectedOptGroup?t(o.selectedOptGroup):angular.noop,m=o.optGroupIdField||"id",f={},h=function(){if(void 0===l){var e=t(o.data)(n);angular.isFunction(e)?(i=e(),l=!0):l=!1}return l?i:t(o.data)(n)},v=function(e){var n=[];return angular.forEach(e,function(e){e.hasOwnProperty(u)&&n.push(e),e.hasOwnProperty("children")&&angular.isArray(e.children)&&e.children.length&&n.push.apply(n,e.children)}),n},y=function(e,t){var a={objectData:null,idData:""},o=v(e);if(f.multiple){t=t?t:[];var r=[],i=[],l={};return angular.forEach(t,function(e){l[e.toString()]=!0}),angular.forEach(o,function(e){l.hasOwnProperty(e[u].toString())&&(r.push(e[u]),i.push(e))}),a.objectData=i,a.idData=r,a}return t=t?t:"",angular.forEach(o,function(e){return e[u].toString()===t.toString()?(p(n,e[m]),a.objectData=e,void(a.idData=t)):void 0}),a},w=function(e){return e?angular.isArray(e)&&0===e.length?!0:!1:!0},b={dropdownAutoWidth:!1,width:"off",query:function(t){e.when(h()).then(function(e){var a=[];if(e||(e=[]),t.term&&""!==t.term){var o=t.term.toLowerCase();angular.forEach(e,function(e){var n=angular.copy(e),t=!1,r=n.children;n.children=[],-1!==n[s].toString().toLowerCase().indexOf(o)&&(t=!0),r&&angular.isArray(r)&&angular.forEach(r,function(e){-1!==e[s].toString().toLowerCase().indexOf(o)&&(t=!0,n.children.push(e))}),t&&a.push(n)})}else a=e.slice(0);var r=g(n);if(r){var i={};i[m]=r;var l=_.findWhere(a,i);if(l){var u=_.indexOf(a,l);a.splice(u,1),a.splice(0,0,l)}}t.callback({more:!1,results:a})})},formatResult:function(e,n,t,a){var o=[];window.Select2.util.markMatch(e[s],t.term,o,a);var r=o.join("");return e[c]&&(r='<i class="select2-inline-icon '+e[c]+'"></i> '+r),r},formatSelection:function(e,n,t){var a=t(e[s]);return e[c]&&(a='<i class="select2-inline-icon '+e[c]+'"></i> '+a),a},id:function(e){return e[u]},initSelection:function(a,i){var l=n.$eval(o.ngModel);e.when(h()).then(function(e){var a=y(e,l);i(a.objectData),r.$viewValue=a.idData,d(n,a.objectData),w(a.idData)&&t(o.ngModel).assign(n,a.idData)})},formatSearching:function(){return"Loading..."}};angular.extend(f,b,n.$eval(o.dcmSelect2)),a.select2(f),a.on("change",function(e){n.$apply(function(){r.$setViewValue(e.val),t(o.ngModel).assign(n,e.val),d(n,a.select2("data")),o.sticky&&t(o.sticky).assign(n,e.val)})}),o.$observe("disabled",function(e){a.select2("enable",!e)}),o.$observe("readonly",function(e){a.select2("readonly",!!e)}),n.$watch(t(o.ngModel),function(e){if(w(e)){var r=f.multiple?[]:"";angular.equals(e,r)||t(o.ngModel).assign(n,r),a.select2("data",r,!1),d(n,r)}else o.sticky&&t(o.sticky).assign(n,e),a.select2("val",e,!1)}),o.modelSelected&&n.$watch(t(o.modelSelected),function(e){if(!angular.equals(e,a.select2("data"))){a.select2("data",e,!1);var i=a.select2("val");r.$viewValue=i,t(o.ngModel).assign(n,i)}}),n.$watchCollection(h,function(i){var l=a.select2("val");(o.sticky||!w(l))&&e.when(i).then(function(e){var i,u=l;o.sticky&&w(l)&&(u=t(o.sticky)(n)),i=y(e,u),angular.equals(l,i.idData)||(a.select2("data",i.objectData,!1),d(n,i.objectData),r.$viewValue=i.idData,t(o.ngModel).assign(n,i.idData))})})}}}}]);
//# sourceMappingURL=dcm-ui-select2.min.js.map