"use strict";angular.module("dcm-ui.resizable-cols",["dcm-ui.helpers.drag"]),angular.module("dcm-ui.resizable-cols").controller("ResizableColumnsCtrl",["$timeout",function(e){var t=this,n=t.cols=[],a=[];t.dragBox=angular.element('<div class="resizable-columns-drag-box" style="position: absolute;">'),t.dragBox.on("click",function(e){e.stopPropagation(),e.preventDefault()});var r=!1;t.addCol=function(o,i){n.push(o),a.push(i),r||(r=!0,e(t.resizeAll,0))},t.removeCol=function(e){var t=n.indexOf(e);n.splice(t,1),a.splice(t,1)},t.resizeAll=function(){r=!1}}]),angular.module("dcm-ui.resizable-cols").directive("resizableColumn",["$log","$document","$timeout","dragHelper",function(e,t,n,a){return{restrict:"AC",scope:!1,require:"^resizableColumns",compile:function(){return function(t,r,o,i){var l=r.next();if(!l.length||!l.hasClass("resizable-column")&&void 0===l.attr("resizable-column"))r.removeClass("resizable-column"),r.css("width","auto");else{r.addClass("resizable-column");var s=angular.element('<a class="resizable-columns-drag-handle"></a>');s.css({cursor:"col-resize",position:"absolute",display:"block",width:"10px"}),i.addCol(r,s);var u=function(){s.height(r.outerHeight(!1));var e=l.offset(),t=e.left-s.width()/2;s.offset({top:e.top,left:t})},c=t.$watch(function(){return l[0].offsetLeft+i.table[0].offsetLeft},function(t,n){t!==n&&Math.abs(n-t)>=1&&(e.info("RESIZABLE: position changed: "+r.text()+" "+(Math.round(100*(n-t))/100).toString()+"px"),u())});n(function(){i.table.after(s),u(),r.attr("style")&&r.attr("style").match(/(\b|;)\s*width\s*:/)||r.width(r.width())},0);var d,f,m,p=function(e,t){return Math.round(Math.min(Math.max(t.current+e.dX,t.min),t.max))},g=function(e){var t=b(),n=p(e,t)-t.current;i.dragBox.offset({top:f,left:n}),s.offset({left:d.left+n})},h=function(e){i.dragBox.remove(),r.removeClass("resizing"),s.removeClass("resizing");var t=b();v(p(e,t)),u()},v=function(e){var n=b(),a=n.combined-e;Math.abs(e-n.current)>=1&&(n.nextResizable||l.css("width","auto"),e<n.current||!n.nextResizable?(r.width(e),a=n.combined-r.width(),n.nextResizable&&r.width()!==n.current&&l.width(a)):(l.width(a),e=n.combined-l.width(),l.width()!==n.currentNext&&r.width(e)),t.$emit("TABLE_COL_RESIZED"))},b=function(){var e=r.width(),t=l.width(),n=e+t,a=Math.round(y(r)),o=Math.round(y(l)),i=n-o;return{current:e,currentNext:t,combined:n,min:a,minNext:o,max:i,nextResizable:l.is(".resizable-column")}},w=function(){var t=b();return t.combined<=t.min+t.minNext?(e.info("RESIZABLE: both cols are too narrow to resize further"),!1):(d=s.offset(),m=Math.round(l.offset().left-1),r.addClass("resizing"),s.addClass("resizing"),i.table.after(i.dragBox),f=i.table.offset().top,i.dragBox.height(i.table.height()).width(m).offset({top:f,left:0}),void 0)},y=function(e){var t=angular.element('<span style="display:inline; padding: 0; margin: 0;">');e.append(t),t.append(e.contents());var n=t.outerWidth(!0);return e.append(t.contents()),t.remove(),n},x=function(){var t=b();if(t.combined<=t.min+t.minNext)e.info("RESIZABLE: both cols are too narrow to resize further");else{v(t.max);var n=r.parent().children().index(r),a=Math.min(y(r),t.max),o=i.table.find("tbody>tr>td:nth-child("+(n+1).toString()+")");angular.forEach(o,function(e){a=Math.max(a,Math.min(y(angular.element(e)),t.max))}),v(a)}};a.draggable(s,{dragCursor:"col-resize",mouseUp:h,mouseDown:w,mouseMove:g,mouseDoubleClick:x}),r.on("$destroy",function(){c(),i.removeCol(r),s.remove()})}}}}}]),angular.module("dcm-ui.resizable-cols").directive("resizableColumns",[function(){return{restrict:"AC",controller:"ResizableColumnsCtrl",compile:function(){return function(e,t,n,a){t.addClass("resizable-columns"),a.table=t,a.visible=!1,e.$watch(function(){return t[0].offsetWidth},function(e){a.visible=!!e})}}}}]);
//# sourceMappingURL=dcm-ui-resizable-cols.min.js.map